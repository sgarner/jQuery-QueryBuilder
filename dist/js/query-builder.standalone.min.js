/*!
 * jQuery QueryBuilder 1.4.2
 * Copyright 2014-2015 Damien "Mistic" Sorel (http://www.strangeplanet.fr)
 * Licensed under MIT (http://opensource.org/licenses/MIT)
 */
!function(a,b){"function"==typeof define&&define.amd?define("query-builder",["jquery","microevent","jQuery.extendext"],b):b(a.jQuery,a.MicroEvent)}(this,function($,a){"use strict";function b(a){return this instanceof b?void(this.root=null):b.getModel(a)}function c(a,b){b.forEach(function(b){Object.defineProperty(a.prototype,b,{enumerable:!0,get:function(){return this.__[b]},set:function(a){var c=null!==this.__[b]&&"object"==typeof this.__[b]?$.extend({},this.__[b]):this.__[b];this.__[b]=a,null!==this.model&&this.model.trigger("update",this,b,a,c)}})})}function d(a,b){a&&($.isArray(a)?a.forEach(function(a,c){$.isPlainObject(a)?$.each(a,function(a,c){return b(a,c),!1}):b(c,a)}):$.each(a,function(a,c){b(a,c)}))}function e(a,b){return b=Array.prototype.slice.call(arguments),a.replace(/{([0-9]+)}/g,function(a,c){return b[parseInt(c)+1]})}function f(){$.error(e.apply(null,arguments))}function g(a,b,c){switch(b){case"integer":return parseInt(a);case"double":return parseFloat(a);case"boolean":var d="true"===a.trim().toLowerCase()||"1"===a.trim()||1===a;return c?d?1:0:d;default:return a}}function h(a){return"string"!=typeof a?a:a.replace(/[\0\n\r\b\\\'\"]/g,function(a){switch(a){case"\x00":return"\\0";case"\n":return"\\n";case"\r":return"\\r";case"\b":return"\\b";default:return"\\"+a}}).replace(/\t/g,"\\t").replace(/\x1a/g,"\\Z")}function i(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function j(a,c){var d;return d=c.closest(".rule-container"),d.length?void a.moveAfter(b(d)):(d=c.closest(".rules-group-header"),d.length?(d=c.closest(".rules-group-container"),void a.moveAtBegin(b(d))):(d=c.closest(".rules-group-container"),d.length?void a.moveAtEnd(b(d)):void 0))}var k=function(a,b){this.init(a,b)};a.mixin(k),k.plugins={},k.defaults=function(a){return"object"!=typeof a?"string"==typeof a?"object"==typeof k.DEFAULTS[a]?$.extend(!0,{},k.DEFAULTS[a]):k.DEFAULTS[a]:$.extend(!0,{},k.DEFAULTS):void $.extendext(!0,"replace",k.DEFAULTS,a)},k.define=function(a,b,c){k.plugins[a]={fct:b,def:c||{}}},k.extend=function(a){$.extend(k.prototype,a)},k.prototype.initPlugins=function(){if(this.plugins){if($.isArray(this.plugins)){var a={};this.plugins.forEach(function(b){a[b]=null}),this.plugins=a}Object.keys(this.plugins).forEach(function(a){a in k.plugins?(this.plugins[a]=$.extend(!0,{},k.plugins[a].def,this.plugins[a]||{}),k.plugins[a].fct.call(this,this.plugins[a])):f('Unable to find plugin "{0}"',a)},this)}},k.types={string:"string",integer:"number","double":"number",date:"datetime",time:"datetime",datetime:"datetime","boolean":"boolean"},k.inputs=["text","textarea","radio","checkbox","select"],k.DEFAULTS={filters:[],plugins:{},display_errors:!0,allow_groups:-1,allow_empty:!1,conditions:["AND","OR"],default_condition:"AND",inputs_separator:" , ",select_placeholder:"------",default_rule_flags:{filter_readonly:!1,operator_readonly:!1,value_readonly:!1,no_delete:!1},template:{group:null,rule:null},lang:{add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",condition_and:"AND",condition_or:"OR",operators:{equal:"equal",not_equal:"not equal","in":"in",not_in:"not in",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",begins_with:"begins with",not_begins_with:"doesn't begin with",contains:"contains",not_contains:"doesn't contain",ends_with:"ends with",not_ends_with:"doesn't end with",is_empty:"is empty",is_not_empty:"is not empty",is_null:"is null",is_not_null:"is not null"},errors:{no_filter:"No filter selected",empty_group:"The group is empty",radio_empty:"No value selected",checkbox_empty:"No value selected",select_empty:"No value selected",string_empty:"Empty value",string_exceed_min_length:"Must contain at least {0} characters",string_exceed_max_length:"Must not contain more than {0} characters",string_invalid_format:"Invalid format ({0})",number_nan:"Not a number",number_not_integer:"Not an integer",number_not_double:"Not a real number",number_exceed_min:"Must be greater than {0}",number_exceed_max:"Must be lower than {0}",number_wrong_step:"Must be a multiple of {0}",datetime_invalid:"Invalid date format ({0})",datetime_exceed_min:"Must be after {0}",datetime_exceed_max:"Must be before {0}",boolean_not_valid:"Not a boolean",operator_not_multiple:"Operator {0} cannot accept multiple values"}},operators:[{type:"equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},{type:"not_equal",nb_inputs:1,multiple:!1,apply_to:["string","number","datetime","boolean"]},{type:"in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},{type:"not_in",nb_inputs:1,multiple:!0,apply_to:["string","number","datetime"]},{type:"less",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},{type:"less_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},{type:"greater",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},{type:"greater_or_equal",nb_inputs:1,multiple:!1,apply_to:["number","datetime"]},{type:"between",nb_inputs:2,multiple:!1,apply_to:["number","datetime"]},{type:"begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"not_begins_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"contains",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"not_contains",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"not_ends_with",nb_inputs:1,multiple:!1,apply_to:["string"]},{type:"is_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},{type:"is_not_empty",nb_inputs:0,multiple:!1,apply_to:["string"]},{type:"is_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]},{type:"is_not_null",nb_inputs:0,multiple:!1,apply_to:["string","number","datetime","boolean"]}],icons:{add_group:"glyphicon glyphicon-plus-sign",add_rule:"glyphicon glyphicon-plus",remove_group:"glyphicon glyphicon-remove",remove_rule:"glyphicon glyphicon-remove",error:"glyphicon glyphicon-warning-sign"}},k.prototype.init=function(a,c){a[0].queryBuilder=this,this.$el=a,this.settings=$.extendext(!0,"replace",{},k.DEFAULTS,c),this.model=new b,this.status={group_id:0,rule_id:0,generated_id:!1,has_optgroup:!1,id:null},this.settings.allow_groups===!1?this.settings.allow_groups=0:this.settings.allow_groups===!0&&(this.settings.allow_groups=-1),this.filters=this.settings.filters,this.lang=this.settings.lang,this.icons=this.settings.icons,this.operators=this.settings.operators,this.template=this.settings.template,this.plugins=this.settings.plugins,null===this.template.group&&(this.template.group=this.getGroupTemplate),null===this.template.rule&&(this.template.rule=this.getRuleTemplate),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generated_id=!0),this.status.id=this.$el.attr("id"),this.$el.addClass("query-builder form-inline"),this.checkFilters(),this.bindEvents(),this.initPlugins(),this.trigger("afterInit"),c.rules?(this.setRules(c.rules),delete this.settings.rules):this.setRoot(!0)},k.prototype.checkFilters=function(){var a=[],b=this;if(this.filters&&0!==this.filters.length||f("Missing filters list"),this.filters.forEach(function(c,d){switch(c.id||f("Missing filter {0} id",d),-1!=a.indexOf(c.id)&&f('Filter "{0}" already defined',c.id),a.push(c.id),c.type||f('Missing filter "{0}" type',c.id),k.types[c.type]||f('Invalid type "{0}"',c.type),c.input?"function"!=typeof c.input&&-1==k.inputs.indexOf(c.input)&&f('Invalid input "{0}"',c.input):c.input="text",c.field||(c.field=c.id),c.label||(c.label=c.field),c.optgroup?b.status.has_optgroup=!0:c.optgroup=null,c.input){case"radio":case"checkbox":(!c.values||c.values.length<1)&&f('Missing filter "{0}" values',c.id)}}),this.status.has_optgroup){var c=[],d=[];this.filters.forEach(function(a){var b;a.optgroup?(b=c.lastIndexOf(a.optgroup),-1==b?b=c.length:b++):b=c.length,c.splice(b,0,a.optgroup),d.splice(b,0,a)}),this.filters=d}this.trigger("afterCheckFilters")},k.prototype.bindEvents=function(){var a=this;this.$el.on("change.queryBuilder",".rules-group-header [name$=_cond]",function(){if($(this).is(":checked")){var a=$(this).closest(".rules-group-container");b(a).condition=$(this).val()}}),this.$el.on("change.queryBuilder",".rule-filter-container [name$=_filter]",function(){var c=$(this).closest(".rule-container");b(c).filter=a.getFilterById($(this).val())}),this.$el.on("change.queryBuilder",".rule-operator-container [name$=_operator]",function(){var c=$(this).closest(".rule-container");b(c).operator=a.getOperatorByType($(this).val())}),this.$el.on("click.queryBuilder","[data-add=rule]",function(){var c=$(this).closest(".rules-group-container");a.addRule(b(c))}),this.$el.on("click.queryBuilder","[data-delete=rule]",function(){var c=$(this).closest(".rule-container");a.deleteRule(b(c))}),0!==this.settings.allow_groups&&(this.$el.on("click.queryBuilder","[data-add=group]",function(){var c=$(this).closest(".rules-group-container");a.addGroup(b(c))}),this.$el.on("click.queryBuilder","[data-delete=group]",function(){var c=$(this).closest(".rules-group-container");a.deleteGroup(b(c))})),this.model.on({drop:function(a){a.$el.remove()},add:function(a,b){a.$el.detach(),0===b?a.$el.prependTo(a.parent.$el.find(">.rules-group-body>.rules-list")):a.$el.insertAfter(a.parent.rules[b-1].$el)},update:function(b,c,d,e){switch(c){case"error":a.displayError(b);break;case"condition":a.updateGroupCondition(b);break;case"filter":a.updateRuleFilter(b);break;case"operator":a.updateRuleOperator(b,e);break;case"flags":a.applyRuleFlags(b)}}})},k.prototype.setRoot=function(a){a=void 0===a||a===!0;var b=this.nextGroupId(),c=$(this.template.group.call(this,b,1));return this.$el.append(c),this.model.root=new m(null,c),this.model.root.model=this.model,this.model.root.condition=this.settings.default_condition,a&&this.addRule(this.model.root),this.model.root},k.prototype.addGroup=function(a,b){b=void 0===b||b===!0;var c=this.trigger("beforeAddGroup",a,b,a.level+1);if(c.isDefaultPrevented())return null;var d=this.nextGroupId(),e=$(this.template.group.call(this,d,a.level+1)),f=a.addGroup(e);return this.trigger("afterAddGroup",f),f.condition=this.settings.default_condition,b&&this.addRule(f),f},k.prototype.deleteGroup=function(a){if(a.isRoot())return!1;var b=this.trigger("beforeDeleteGroup",a);if(b.isDefaultPrevented())return!1;var c=!0;return a.each("reverse",function(a){c&=this.deleteRule(a)},function(a){c&=this.deleteGroup(a)},this),c&&a.drop(),this.trigger("afterDeleteGroup",c),c},k.prototype.updateGroupCondition=function(a){a.$el.find(">.rules-group-header [name$=_cond]").each(function(){var b=$(this);b.prop("checked",b.val()===a.condition),b.parent().toggleClass("active",b.val()===a.condition)})},k.prototype.addRule=function(a){var b=this.trigger("beforeAddRule",a);if(b.isDefaultPrevented())return null;var c=this.nextRuleId(),d=$(this.template.rule.call(this,c)),e=a.addRule(d);return this.trigger("afterAddRule",e),this.createRuleFilters(e),e},k.prototype.deleteRule=function(a){if(a.flags.no_delete)return!1;var b=this.trigger("beforeDeleteRule",a);return b.isDefaultPrevented()?!1:(a.drop(),this.trigger("afterDeleteRule"),!0)},k.prototype.createRuleFilters=function(a){var b=$(this.getRuleFilterSelect(a,this.filters));a.$el.find(".rule-filter-container").append(b),this.trigger("afterCreateRuleFilters",a)},k.prototype.createRuleOperators=function(a,b){var c=a.$el.find(".rule-operator-container").empty();if(a.filter){var d=this.getOperators(a.filter),e=$(this.getRuleOperatorSelect(a,d));c.html(e),b!==!1?a.operator=d[0]:a.__.operator=d[0],this.trigger("afterCreateRuleOperators",a,d)}},k.prototype.createRuleInput=function(a){var b=a.$el.find(".rule-value-container").empty();if(a.filter&&0!==a.operator.nb_inputs){for(var c=$(),d=a.filter,e=0;e<a.operator.nb_inputs;e++){var f=$(this.getRuleInput(a,e));e>0&&b.append(this.settings.inputs_separator),b.append(f),c=c.add(f)}b.show(),d.plugin&&c[d.plugin](d.plugin_config||{}),void 0!==d.default_value&&this.setRuleValue(a,d.default_value),this.trigger("afterCreateRuleInput",a)}},k.prototype.updateRuleFilter=function(a){this.createRuleOperators(a,!1),this.createRuleInput(a),a.$el.find(".rule-filter-container [name$=_filter]").val(a.filter?a.filter.id:"-1"),this.trigger("afterUpdateRuleFilter",a)},k.prototype.updateRuleOperator=function(a,b){var c=a.$el.find(".rule-value-container");a.operator&&0!==a.operator.nb_inputs?(c.show(),(c.is(":empty")||a.operator.nb_inputs!==b.nb_inputs)&&this.createRuleInput(a),a.$el.find(".rule-operator-container [name$=_operator]").val(a.operator.type)):c.hide(),this.trigger("afterUpdateRuleOperator",a)},k.prototype.applyRuleFlags=function(a){var b=a.flags;b.filter_readonly&&a.$el.find("[name$=_filter]").prop("disabled",!0),b.operator_readonly&&a.$el.find("[name$=_operator]").prop("disabled",!0),b.value_readonly&&a.$el.find("[name*=_value_]").prop("disabled",!0),b.no_delete&&a.$el.find("[data-delete=rule]").remove(),this.trigger("afterApplyRuleFlags",a)},k.prototype.clearErrors=function(a){a=a||this.model.root,a.error=null,a instanceof m&&a.each(function(a){a.error=null},function(a){this.clearErrors(a)},this)},k.prototype.displayError=function(a){if(this.settings.display_errors)if(null===a.error)a.$el.removeClass("has-error");else{var b=$.extend([],a.error,[this.lang.errors[a.error[0]]||a.error[0]]);a.$el.addClass("has-error").find(".error-container").eq(0).attr("title",e.apply(null,b))}},k.prototype.triggerValidationError=function(a,b,c){$.isArray(b)||(b=[b]);var d=this.trigger("validationError",a,b,c);d.isDefaultPrevented()||(a.error=b)},k.prototype.destroy=function(){this.trigger("beforeDestroy"),this.status.generated_id&&this.$el.removeAttr("id"),this.clear(),this.model=null,this.$el.off(".queryBuilder").removeClass("query-builder").removeData("queryBuilder"),delete this.$el[0].queryBuilder},k.prototype.reset=function(){this.status.group_id=1,this.status.rule_id=0,this.model.root.empty(),this.addRule(this.model.root),this.trigger("afterReset")},k.prototype.clear=function(){this.status.group_id=0,this.status.rule_id=0,this.model.root&&(this.model.root.drop(),this.model.root=null),this.trigger("afterClear")},k.prototype.validate=function(){this.clearErrors();var a=this,b=function c(b){var d=0,e=0;return b.each(function(b){if(!b.filter)return a.triggerValidationError(b,"no_filter",null),void e++;if(0!==b.operator.nb_inputs){var c=a.getRuleValue(b),f=a.validateValue(b,c);if(f!==!0)return a.triggerValidationError(b,f,c),void e++}d++},function(a){c(a)?d++:e++}),e>0?!1:0!==d||a.settings.allow_empty&&b.isRoot()?!0:(a.triggerValidationError(b,"empty_group",null),!1)}(this.model.root);return this.change("validate",b)},k.prototype.getRules=function(){if(!this.validate())return{};var a=this,b=function c(b){var d={condition:b.condition,rules:[]};return b.each(function(b){var c=null;0!==b.operator.nb_inputs&&(c=a.getRuleValue(b));var e={id:b.filter.id,field:b.filter.field,type:b.filter.type,input:b.filter.input,operator:b.operator.type,value:c};(b.filter.data||b.data)&&(e.data=$.extendext(!0,"replace",{},b.filter.data,b.data)),d.rules.push(e)},function(a){d.rules.push(c(a))}),d}(this.model.root);return this.change("getRules",b)},k.prototype.setRules=function(a){this.clear(),this.setRoot(!1),a&&a.rules&&(0!==a.rules.length||this.settings.allow_empty)||f("Incorrect data object passed"),a=this.change("setRules",a);var b=this;!function c(a,d){null!==d&&(void 0===a.condition?a.condition=b.settings.default_condition:-1==b.settings.conditions.indexOf(a.condition)&&f('Invalid condition "{0}"',a.condition),d.condition=a.condition.toUpperCase(),a.rules.forEach(function(a){var e;if(a.rules&&a.rules.length>0)-1!=b.settings.allow_groups&&b.settings.allow_groups<d.level?(b.reset(),f("No more than {0} groups are allowed",b.settings.allow_groups)):(e=b.addGroup(d,!1),c(a,e));else{if(void 0===a.id&&f("Missing rule field id"),void 0===a.value&&(a.value=""),void 0===a.operator&&(a.operator="equal"),e=b.addRule(d),null===e)return;e.filter=b.getFilterById(a.id),e.operator=b.getOperatorByType(a.operator),e.flags=b.parseRuleFlags(a),a.data&&(e.data=a.data),0!==e.operator.nb_inputs&&b.setRuleValue(e,a.value)}}))}(a,this.model.root)},k.prototype.validateValue=function(a,b){var c=a.filter.validation||{},d=!0;return d=c.callback?c.callback.call(this,b,a):this.validateValueInternal(a,b),this.change("validateValue",d,b,a)},k.prototype.validateValueInternal=function(a,b){var c,d=a.filter,e=a.operator,g=d.validation||{},h=!0;b=1===a.operator.nb_inputs?[b]:b;for(var i=0;i<e.nb_inputs;i++){switch(d.input){case"radio":if(void 0===b[i]){h=["radio_empty"];break}break;case"checkbox":if(0===b[i].length){h=["checkbox_empty"];break}if(!e.multiple&&b[i].length>1){h=["operator_not_multiple",this.lang[e.type]||e.type];break}break;case"select":if(d.multiple){if(0===b[i].length){h=["select_empty"];break}if(!e.multiple&&b[i].length>1){h=["operator_not_multiple",this.lang[e.type]||e.type];break}}else if(void 0===b[i]){h=["select_empty"];break}break;default:switch(k.types[d.type]){case"string":if(void 0!==g.min){if(b[i].length<g.min){h=["string_exceed_min_length",g.min];break}}else if(0===b[i].length){h=["string_empty"];break}if(void 0!==g.max&&b[i].length>g.max){h=["string_exceed_max_length",g.max];break}if(g.format&&!g.format.test(b[i])){h=["string_invalid_format",g.format];break}break;case"number":if(isNaN(b[i])){h=["number_nan"];break}if("integer"==d.type){if(parseInt(b[i])!=b[i]){h=["number_not_integer"];break}}else if(parseFloat(b[i])!=b[i]){h=["number_not_double"];break}if(void 0!==g.min&&b[i]<g.min){h=["number_exceed_min",g.min];break}if(void 0!==g.max&&b[i]>g.max){h=["number_exceed_max",g.max];break}if(void 0!==g.step){var j=b[i]/g.step;if(parseInt(j)!=j){h=["number_wrong_step",g.step];break}}break;case"datetime":if(g.format){"moment"in window||f("MomentJS is required for Date/Time validation");var l=moment(b[i],g.format);if(!l.isValid()){h=["datetime_invalid"];break}if(g.min&&l<moment(g.min,g.format)){h=["datetime_exceed_min",g.min];break}if(g.max&&l>moment(g.max,g.format)){h=["datetime_exceed_max",g.max];break}}break;case"boolean":if(c=b[i].trim().toLowerCase(),"true"!==c&&"false"!==c&&"1"!==c&&"0"!==c&&1!==b[i]&&0!==b[i]){h=["boolean_not_valid"];break}}}if(h!==!0)break}return h},k.prototype.nextGroupId=function(){return this.status.id+"_group_"+this.status.group_id++},k.prototype.nextRuleId=function(){return this.status.id+"_rule_"+this.status.rule_id++},k.prototype.getOperators=function(a){"string"==typeof a&&(a=this.getFilterById(a));for(var b=[],c=0,d=this.operators.length;d>c;c++){if(a.operators){if(-1==a.operators.indexOf(this.operators[c].type))continue}else if(-1==this.operators[c].apply_to.indexOf(k.types[a.type]))continue;b.push(this.operators[c])}return a.operators&&b.sort(function(b,c){return a.operators.indexOf(b.type)-a.operators.indexOf(c.type)}),this.change("getOperators",b,a)},k.prototype.getFilterById=function(a){if("-1"==a)return null;for(var b=0,c=this.filters.length;c>b;b++)if(this.filters[b].id==a)return this.filters[b];f('Undefined filter "{0}"',a)},k.prototype.getOperatorByType=function(a){if("-1"==a)return null;for(var b=0,c=this.operators.length;c>b;b++)if(this.operators[b].type==a)return this.operators[b];f('Undefined operator  "{0}"',a)},k.prototype.getRuleValue=function(a){for(var b,c=a.filter,d=a.operator,e=a.$el.find(".rule-value-container"),f=[],g=0;g<d.nb_inputs;g++){var h=a.id+"_value_"+g;switch(c.input){case"radio":f.push(e.find("[name="+h+"]:checked").val());break;case"checkbox":b=[],e.find("[name="+h+"]:checked").each(function(){b.push($(this).val())}),f.push(b);break;case"select":c.multiple?(b=[],e.find("[name="+h+"] option:selected").each(function(){b.push($(this).val())}),f.push(b)):f.push(e.find("[name="+h+"] option:selected").val());break;default:f.push(e.find("[name="+h+"]").val())}}return 1===d.nb_inputs&&(f=f[0]),c.valueParser&&(f=c.valueParser.call(this,a,f)),this.change("getRuleValue",f,a)},k.prototype.setRuleValue=function(a,b){var c=a.filter,d=a.operator;if(this.trigger("beforeSetRuleValue",a,b),c.valueSetter)c.valueSetter.call(this,a,b);else{var e=a.$el.find(".rule-value-container");b=1==d.nb_inputs?[b]:b;for(var f=0;f<d.nb_inputs;f++){var g=a.id+"_value_"+f;switch(c.input){case"radio":e.find("[name="+g+'][value="'+b[f]+'"]').prop("checked",!0).trigger("change");break;case"checkbox":$.isArray(b[f])||(b[f]=[b[f]]),b[f].forEach(function(a){e.find("[name="+g+'][value="'+a+'"]').prop("checked",!0).trigger("change")});break;default:e.find("[name="+g+"]").val(b[f]).trigger("change")}}}this.trigger("afterSetRuleValue",a,b)},k.prototype.parseRuleFlags=function(a){var b=$.extend({},this.settings.default_rule_flags);return a.readonly&&$.extend(b,{filter_readonly:!0,operator_readonly:!0,value_readonly:!0,no_delete:!0}),a.flags&&$.extend(b,a.flags),this.change("parseRuleFlags",b,a)},k.prototype.getGroupTemplate=function(a,b){var c='<dl id="'+a+'" class="rules-group-container">   <dt class="rules-group-header">     <div class="btn-group pull-right group-actions">       <button type="button" class="btn btn-xs btn-success" data-add="rule">         <i class="'+this.icons.add_rule+'"></i> '+this.lang.add_rule+"       </button>       "+(-1===this.settings.allow_groups||this.settings.allow_groups>=b?'<button type="button" class="btn btn-xs btn-success" data-add="group">           <i class="'+this.icons.add_group+'"></i> '+this.lang.add_group+"         </button>":"")+"       "+(b>1?'<button type="button" class="btn btn-xs btn-danger" data-delete="group">           <i class="'+this.icons.remove_group+'"></i> '+this.lang.delete_group+"         </button>":"")+'     </div>     <div class="btn-group group-conditions">       '+this.getGroupConditions(a)+"     </div>     "+(this.settings.display_errors?'<div class="error-container"><i class="'+this.icons.error+'"></i></div>':"")+"  </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>";return this.change("getGroupTemplate",c,b)},k.prototype.getGroupConditions=function(a){for(var b="",c=0,d=this.settings.conditions.length;d>c;c++){var e=this.settings.conditions[c],f=this.lang["condition_"+e.toLowerCase()]||e;b+='        <label class="btn btn-xs btn-primary">           <input type="radio" name="'+a+'_cond" value="'+e+'"> '+f+"         </label>"}return this.change("getGroupConditions",b)},k.prototype.getRuleTemplate=function(a){var b='<li id="'+a+'" class="rule-container">   <div class="rule-header">   <div class="btn-group pull-right rule-actions">     <button type="button" class="btn btn-xs btn-danger" data-delete="rule">       <i class="'+this.icons.remove_rule+'"></i> '+this.lang.delete_rule+"     </button>   </div>   </div>   "+(this.settings.display_errors?'<div class="error-container"><i class="'+this.icons.error+'"></i></div>':"")+'  <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </li>';return this.change("getRuleTemplate",b)},k.prototype.getRuleFilterSelect=function(a,b){var c=null,d='<select class="form-control" name="'+a.id+'_filter">';return d+='<option value="-1">'+this.settings.select_placeholder+"</option>",b.forEach(function(a){c!=a.optgroup&&(null!==c&&(d+="</optgroup>"),c=a.optgroup,null!==c&&(d+='<optgroup label="'+c+'">')),d+='<option value="'+a.id+'">'+a.label+"</option>"}),null!==c&&(d+="</optgroup>"),d+="</select>",this.change("getRuleFilterSelect",d,a)},k.prototype.getRuleOperatorSelect=function(a,b){for(var c='<select class="form-control" name="'+a.id+'_operator">',d=0,e=b.length;e>d;d++){var f=this.lang.operators[b[d].type]||b[d].type;c+='<option value="'+b[d].type+'">'+f+"</option>"}return c+="</select>",this.change("getRuleOperatorSelect",c,a)},k.prototype.getRuleInput=function(a,b){var c=a.filter,e=a.filter.validation||{},f=a.id+"_value_"+b,g=c.vertical?" class=block":"",h="";if("function"==typeof c.input)h=c.input.call(this,a,f);else switch(c.input){case"radio":d(c.values,function(a,b){h+="<label"+g+'><input type="radio" name="'+f+'" value="'+a+'"> '+b+"</label> "});break;case"checkbox":d(c.values,function(a,b){h+="<label"+g+'><input type="checkbox" name="'+f+'" value="'+a+'"> '+b+"</label> "});break;case"select":h+='<select class="form-control" name="'+f+'"'+(c.multiple?" multiple":"")+">",d(c.values,function(a,b){h+='<option value="'+a+'"> '+b+"</option> "}),h+="</select>";break;case"textarea":h+='<textarea class="form-control" name="'+f+'"',c.size&&(h+=' cols="'+c.size+'"'),c.rows&&(h+=' rows="'+c.rows+'"'),void 0!==e.min&&(h+=' minlength="'+e.min+'"'),void 0!==e.max&&(h+=' maxlength="'+e.max+'"'),c.placeholder&&(h+=' placeholder="'+c.placeholder+'"'),h+="></textarea>";break;default:switch(k.types[c.type]){case"number":h+='<input class="form-control" type="number" name="'+f+'"',void 0!==e.step&&(h+=' step="'+e.step+'"'),void 0!==e.min&&(h+=' min="'+e.min+'"'),void 0!==e.max&&(h+=' max="'+e.max+'"'),c.placeholder&&(h+=' placeholder="'+c.placeholder+'"'),c.size&&(h+=' size="'+c.size+'"'),h+=">";break;default:h+='<input class="form-control" type="text" name="'+f+'"',c.placeholder&&(h+=' placeholder="'+c.placeholder+'"'),"string"===c.type&&void 0!==e.min&&(h+=' minlength="'+e.min+'"'),"string"===c.type&&void 0!==e.max&&(h+=' maxlength="'+e.max+'"'),c.size&&(h+=' size="'+c.size+'"'),h+=">"}}return this.change("getRuleInput",h,a,f)},a.mixin(b),b.getModel=function(a){return a?a instanceof l?a:$(a).data("queryBuilderModel"):null};var l=function(a,b){return this instanceof l?(Object.defineProperty(this,"__",{value:{}}),b.data("queryBuilderModel",this),this.model=null===a?null:a.model,this.parent=a,this.$el=b,this.id=b[0].id,this.error=null,void(this.data=void 0)):new l};c(l,["level","error","data"]),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){return this.__.parent},set:function(a){this.__.parent=a,this.level=null===this.parent?1:this.parent.level+1}}),l.prototype.isRoot=function(){return 1===this.level},l.prototype.getPos=function(){return this.isRoot()?-1:this.parent.getNodePos(this)},l.prototype.drop=function(){null!==this.model&&this.model.trigger("drop",this),this.isRoot()||(this.parent._dropNode(this),this.parent=null)},l.prototype.moveAfter=function(a){return this.isRoot()?void 0:(this.parent._dropNode(this),a.parent._addNode(this,a.getPos()+1),this)},l.prototype.moveAtBegin=function(a){return this.isRoot()?void 0:(void 0===a&&(a=this.parent),this.parent._dropNode(this),a._addNode(this,0),this)},l.prototype.moveAtEnd=function(a){return this.isRoot()?void 0:(void 0===a&&(a=this.parent),this.parent._dropNode(this),a._addNode(this,a.length()),this)};var m=function(a,b){return this instanceof m?(l.call(this,a,b),this.condition=null,void(this.rules=[])):new m(a,b)};m.prototype=Object.create(l.prototype),m.prototype.constructor=m,c(m,["condition"]),m.prototype.empty=function(){this.each("reverse",function(a){a.drop()},function(a){a.drop()})},m.prototype.drop=function(){this.empty(),l.prototype.drop.call(this)},m.prototype.length=function(){return this.rules.length},m.prototype._addNode=function(a,b){return void 0===b&&(b=this.length()),this.rules.splice(b,0,a),a.parent=this,null!==this.model&&this.model.trigger("add",a,b),a},m.prototype.addGroup=function(a,b){return this._addNode(new m(this,a),b)},m.prototype.addRule=function(a,b){return this._addNode(new n(this,a),b)},m.prototype._dropNode=function(a){var b=this.getNodePos(a);return-1!==b&&(a.parent=null,this.rules.splice(b,1)),this},m.prototype.getNodePos=function(a){return this.rules.indexOf(a)},m.prototype.each=function(a,b,c,d){"function"==typeof a&&(d=c,c=b,b=a,a=!1),d=void 0===d?null:d;for(var e=a?this.rules.length-1:0,f=a?0:this.rules.length-1,g=a?-1:1,h=function(){return a?e>=f:f>=e},i=!1;h()&&(this.rules[e]instanceof m?void 0!==c&&(i=c.call(d,this.rules[e])===!1):i=b.call(d,this.rules[e])===!1,!i);e+=g);return!i},m.prototype.contains=function(a,b){return-1!==this.getNodePos(a)?!0:b?!this.each(function(){return!0},function(b){return!b.contains(a,!0)}):!1};var n=function(a,b){return this instanceof n?(l.call(this,a,b),this.filter=null,this.operator=null,void(this.flags={})):new n(a,b)};n.prototype=Object.create(l.prototype),n.prototype.constructor=n,c(n,["filter","operator","flags"]),k.Group=m,k.Rule=n,$.fn.queryBuilder=function(a){this.length>1&&f("Unable to initialize on multiple target");var b=this.data("queryBuilder"),c="object"==typeof a&&a||{};return b||"destroy"!=a?(b||this.data("queryBuilder",new k(this,c)),"string"==typeof a?b[a].apply(b,Array.prototype.slice.call(arguments,1)):this):this},$.fn.queryBuilder.constructor=k,$.fn.queryBuilder.defaults=k.defaults,$.fn.queryBuilder.extend=k.extend,$.fn.queryBuilder.define=k.define,k.define("bt-checkbox",function(a){if("glyphicons"==a.font){var b=document.createElement("style");b.innerHTML='.checkbox input[type=checkbox]:checked + label:after {     font-family: "Glyphicons Halflings";     content: "\\e013"; } .checkbox label:after {     padding-left: 4px;     padding-top: 2px;     font-size: 9px; }',document.body.appendChild(b)}this.on("getRuleInput",function(b,c,e){var f=c.filter;if(("radio"===f.input||"checkbox"===f.input)&&!f.plugin){b="",f.colors?"string"==typeof f.colors&&(f.colors={_def:f.colors}):f.colors={};var g,h,i=f.vertical?' style="display:block"':"",j=0;d(f.values,function(c,d){g=f.colors[c]||f.colors._def||a.color,h=e+"_"+j++,b+="<div"+i+' class="'+f.input+" "+f.input+"-"+g+'">   <input type="'+f.input+'" name="'+e+'" id="'+h+'" value="'+c+'">   <label for="'+h+'">'+d+"</label> </div>"})}return b})},{font:"glyphicons",color:"default"}),k.define("bt-selectpicker",function(a){$.fn.selectpicker&&$.fn.selectpicker.Constructor||f('Bootstrap Select is required to use "bt-selectpicker" plugin. Get it here: http://silviomoreto.github.io/bootstrap-select'),this.on("afterCreateRuleFilters",function(b){b.$el.find(".rule-filter-container select").removeClass("form-control").selectpicker(a)}),this.on("afterCreateRuleOperators",function(b){b.$el.find(".rule-operator-container select").removeClass("form-control").selectpicker(a)}),this.on("afterUpdateRuleFilter",function(a){a.$el.find(".rule-filter-container select").selectpicker("render")}),this.on("afterUpdateRuleOperator",function(a){a.$el.find(".rule-operator-container select").selectpicker("render")})},{container:"body",style:"btn-inverse btn-xs",width:"auto",showIcon:!1}),k.define("bt-tooltip-errors",function(a){$.fn.tooltip&&$.fn.tooltip.Constructor&&$.fn.tooltip.Constructor.prototype.fixTitle||f('Bootstrap Tooltip is required to use "bt-tooltip-errors" plugin. Get it here: http://getbootstrap.com'),this.on("getRuleTemplate",function(a){return a.replace('class="error-container"','class="error-container" data-toggle="tooltip"')}),this.on("getGroupTemplate",function(a){return a.replace('class="error-container"','class="error-container" data-toggle="tooltip"')}),this.on("validationError",function(b){b.$el.find(".error-container").eq(0).tooltip(a).tooltip("hide").tooltip("fixTitle")})},{placement:"right"}),k.define("filter-description",function(a){"inline"===a.mode?this.on("afterUpdateRuleFilter",function(b){var c=b.$el.find("p.filter-description");b.filter&&b.filter.description?(0===c.length?(c=$('<p class="filter-description"></p>'),c.appendTo(b.$el)):c.show(),c.html('<i class="'+a.icon+'"></i> '+b.filter.description)):c.hide()}):"popover"===a.mode?($.fn.popover&&$.fn.popover.Constructor&&$.fn.popover.Constructor.prototype.fixTitle||f('Bootstrap Popover is required to use "filter-description" plugin. Get it here: http://getbootstrap.com'),this.on("afterUpdateRuleFilter",function(b){var c=b.$el.find("button.filter-description");b.filter&&b.filter.description?(0===c.length?(c=$('<button type="button" class="btn btn-xs btn-info filter-description" data-toggle="popover"><i class="'+a.icon+'"></i></button>'),c.prependTo(b.$el.find(".rule-actions")),c.popover({placement:"left",container:"body",html:!0}),c.on("mouseout",function(){c.popover("hide");

})):c.show(),c.data("bs.popover").options.content=b.filter.description,c.attr("aria-describedby")&&c.popover("show")):(c.hide(),c.data("bs.popover")&&c.popover("hide"))})):"bootbox"===a.mode&&("bootbox"in window||f('Bootbox is required to use "filter-description" plugin. Get it here: http://bootboxjs.com'),this.on("afterUpdateRuleFilter",function(b){var c=b.$el.find("button.filter-description");b.filter&&b.filter.description?(0===c.length&&(c=$('<button type="button" class="btn btn-xs btn-info filter-description"><i class="'+a.icon+'"></i></button>'),c.prependTo(b.$el.find(".rule-actions")),c.on("click",function(){bootbox.alert(c.data("description"))})),c.data("description",b.filter.description)):c.hide()}))},{icon:"glyphicon glyphicon-info-sign",mode:"popover"}),k.defaults({loopbackOperators:{equal:function(a){return a[0]},not_equal:function(a){return{neq:a[0]}},"in":function(a){return{inq:a}},not_in:function(a){return{nin:a}},less:function(a){return{lt:a[0]}},less_or_equal:function(a){return{lte:a[0]}},greater:function(a){return{gt:a[0]}},greater_or_equal:function(a){return{gte:a[0]}},between:function(a){return{between:a}},begins_with:function(a){return{like:"^"+i(a[0])}},not_begins_with:function(a){return{nlike:"^"+i(a[0])}},contains:function(a){return{like:i(a[0])}},not_contains:function(a){return{nlike:i(a[0])}},ends_with:function(a){return{like:i(a[0])+"$"}},not_ends_with:function(a){return{nlike:i(a[0])+"$"}},is_empty:function(){return""},is_not_empty:function(){return{neq:""}},is_null:function(){return null},is_not_null:function(){return{neq:null}}}}),k.extend({getLoopback:function(a){a=void 0===a?this.getRules():a;var b=this;return function c(a){if(a.condition||(a.condition=b.settings.default_condition),-1===["AND","OR"].indexOf(a.condition.toUpperCase())&&f('Unable to build Loopback query with condition "{0}"',a.condition),!a.rules)return{};var d=[];a.rules.forEach(function(a){if(a.rules&&a.rules.length>0)d.push(c(a));else{var e=b.settings.loopbackOperators[a.operator],h=b.getOperatorByType(a.operator),i=[];void 0===e&&f('Unknown Loopback operation for operator "{0}"',a.operator),0!==h.nb_inputs&&(a.value instanceof Array||(a.value=[a.value]),a.value.forEach(function(b){i.push(g(b,a.type))}));var j={};j[a.field]=e.call(b,i),d.push(j)}});var e={};return d.length>0&&(e[a.condition.toLowerCase()]=d),e}(a)}}),k.defaults({mongoOperators:{equal:function(a){return a[0]},not_equal:function(a){return{$ne:a[0]}},"in":function(a){return{$in:a}},not_in:function(a){return{$nin:a}},less:function(a){return{$lt:a[0]}},less_or_equal:function(a){return{$lte:a[0]}},greater:function(a){return{$gt:a[0]}},greater_or_equal:function(a){return{$gte:a[0]}},between:function(a){return{$gte:a[0],$lte:a[1]}},begins_with:function(a){return{$regex:"^"+i(a[0])}},not_begins_with:function(a){return{$regex:"^(?!"+i(a[0])+")"}},contains:function(a){return{$regex:i(a[0])}},not_contains:function(a){return{$regex:"^((?!"+i(a[0])+").)*$",$options:"s"}},ends_with:function(a){return{$regex:i(a[0])+"$"}},not_ends_with:function(a){return{$regex:"(?<!"+i(a[0])+")$"}},is_empty:function(){return""},is_not_empty:function(){return{$ne:""}},is_null:function(){return null},is_not_null:function(){return{$ne:null}}},mongoRuleOperators:{$ne:function(a){return a=a.$ne,{val:a,op:null===a?"is_not_null":""===a?"is_not_empty":"not_equal"}},eq:function(a){return{val:a,op:null===a?"is_null":""===a?"is_empty":"equal"}},$regex:function(a){return a=a.$regex,"^(?!"==a.slice(0,4)&&")"==a.slice(-1)?{val:a.slice(4,-1),op:"not_begins_with"}:"^((?!"==a.slice(0,5)&&").)*$"==a.slice(-5)?{val:a.slice(5,-5),op:"not_contains"}:"(?<!"==a.slice(0,4)&&")$"==a.slice(-2)?{val:a.slice(4,-2),op:"not_ends_with"}:"$"==a.slice(-1)?{val:a.slice(0,-1),op:"ends_with"}:"^"==a.slice(0,1)?{val:a.slice(1),op:"begins_with"}:{val:a,op:"contains"}},between:function(a){return{val:[a.$gte,a.$lte],op:"between"}},$in:function(a){return{val:a.$in,op:"in"}},$nin:function(a){return{val:a.$nin,op:"not_in"}},$lt:function(a){return{val:a.$lt,op:"less"}},$lte:function(a){return{val:a.$lte,op:"less_or_equal"}},$gt:function(a){return{val:a.$gt,op:"greater"}},$gte:function(a){return{val:a.$gte,op:"greater_or_equal"}}}}),k.extend({getMongo:function(a){a=void 0===a?this.getRules():a;var b=this;return function c(a){if(a.condition||(a.condition=b.settings.default_condition),-1===["AND","OR"].indexOf(a.condition.toUpperCase())&&f('Unable to build MongoDB query with condition "{0}"',a.condition),!a.rules)return{};var d=[];a.rules.forEach(function(a){if(a.rules&&a.rules.length>0)d.push(c(a));else{var e=b.settings.mongoOperators[a.operator],h=b.getOperatorByType(a.operator),i=[];void 0===e&&f('Unknown MongoDB operation for operator "{0}"',a.operator),0!==h.nb_inputs&&(a.value instanceof Array||(a.value=[a.value]),a.value.forEach(function(b){i.push(g(b,a.type,!1))}));var j={};j[a.field]=e.call(b,i),d.push(j)}});var e={};return d.length>0&&(e["$"+a.condition.toLowerCase()]=d),e}(a)},getRulesFromMongo:function(a){if(void 0===a||null===a)return null;var b=this,c=["$and","$or"];return function d(a){var e=Object.keys(a);e.length>1&&f("Invalid MongoDB query format."),-1===c.indexOf(e[0].toLowerCase())&&f('Unable to build Rule from MongoDB query with condition "{0}"',e[0]);var g=e[0].toLowerCase()===c[0]?"AND":"OR",h=a[e[0]],i=[];h.forEach(function(a){var e=Object.keys(a);if(-1!==c.indexOf(e[0].toLowerCase()))i.push(d(a));else{var g=e[0],h=a[g],j=b.determineMongoOperator(h,g);void 0===j&&f("Invalid MongoDB query format.");var k=b.settings.mongoRuleOperators[j];void 0===k&&f('JSON Rule operation unknown for operator "{0}"',j);var l=k.call(b,h);i.push({id:b.change("getMongoDBFieldID",g,h),field:g,operator:l.op,value:l.val})}});var j={};return i.length>0&&(j.condition=g,j.rules=i),j}(a)},determineMongoOperator:function(a){if(null!==a&&"object"==typeof a){var b=Object.keys(a);return 1===b.length?b[0]:void 0!==a.$gte&&void 0!==a.$lte?"between":void 0!==a.$regex?"$regex":void 0}return"eq"},setRulesFromMongo:function(a){this.setRules(this.getRulesFromMongo(a))}}),k.define("sortable",function(a){this.on("afterInit",function(){$.event.props.push("dataTransfer");var a,c,d=this;this.$el.on("mouseover",".drag-handle",function(){d.$el.find(".rule-container, .rules-group-container").attr("draggable",!0)}),this.$el.on("mouseout",".drag-handle",function(){d.$el.find(".rule-container, .rules-group-container").removeAttr("draggable")}),this.$el.on("dragstart","[draggable]",function(d){d.stopPropagation(),d.dataTransfer.setData("text","drag"),c=b(d.target);var e=$('<div class="rule-placeholder">&nbsp;</div>');e.css("min-height",c.$el.height()),a=c.parent.addRule(e,c.getPos()),setTimeout(function(){c.$el.hide()},0)}),this.$el.on("dragenter","[draggable]",function(b){b.preventDefault(),b.stopPropagation(),j(a,$(b.target))}),this.$el.on("dragover","[draggable]",function(a){a.preventDefault(),a.stopPropagation()}),this.$el.on("drop",function(a){a.preventDefault(),a.stopPropagation(),j(c,$(a.target))}),this.$el.on("dragend","[draggable]",function(b){b.preventDefault(),b.stopPropagation(),c.$el.show(),a.drop(),c=a=null,d.$el.find(".rule-container, .rules-group-container").removeAttr("draggable")})}),this.on("parseRuleFlags",function(b){return void 0===b.no_sortable&&(b.no_sortable=a.default_no_sortable),b}),this.on("afterApplyRuleFlags",function(a){a.flags.no_sortable&&a.$el.find(".drag-handle").remove()}),this.on("getGroupTemplate",function(b,c){if(c>1){var d=$(b);d.find(".group-conditions").after('<div class="drag-handle"><i class="'+a.icon+'"></i></div>'),b=d.prop("outerHTML")}return b}),this.on("getRuleTemplate",function(b){var c=$(b);return c.find(".rule-header").after('<div class="drag-handle"><i class="'+a.icon+'"></i></div>'),c.prop("outerHTML")})},{default_no_sortable:!1,icon:"glyphicon glyphicon-sort"}),k.defaults({sqlOperators:{equal:"= ?",not_equal:"!= ?","in":{op:"IN(?)",sep:", "},not_in:{op:"NOT IN(?)",sep:", "},less:"< ?",less_or_equal:"<= ?",greater:"> ?",greater_or_equal:">= ?",between:{op:"BETWEEN ?",sep:" AND "},begins_with:{op:"LIKE(?)",fn:function(a){return a+"%"}},not_begins_with:{op:"NOT LIKE(?)",fn:function(a){return a+"%"}},contains:{op:"LIKE(?)",fn:function(a){return"%"+a+"%"}},not_contains:{op:"NOT LIKE(?)",fn:function(a){return"%"+a+"%"}},ends_with:{op:"LIKE(?)",fn:function(a){return"%"+a}},not_ends_with:{op:"NOT LIKE(?)",fn:function(a){return"%"+a}},is_empty:'== ""',is_not_empty:'!= ""',is_null:"IS NULL",is_not_null:"IS NOT NULL"}}),k.extend({getSQL:function(a,b,c){c=void 0===c?this.getRules():c,a=a===!0||void 0===a?"question_mark":a,b=b||void 0===b?"\n":" ";var d=this,e=1,i=[],j=function k(c){if(c.condition||(c.condition=d.settings.default_condition),-1===["AND","OR"].indexOf(c.condition.toUpperCase())&&f('Unable to build SQL query with condition "{0}"',c.condition),!c.rules)return"";var j=[];return c.rules.forEach(function(c){if(c.rules&&c.rules.length>0)j.push("("+b+k(c)+b+")"+b);else{var l=d.getSqlOperator(c.operator),m=d.getOperatorByType(c.operator),n="";l===!1&&f('Unknown SQL operation for operator "{0}"',c.operator),0!==m.nb_inputs&&(c.value instanceof Array||(c.value=[c.value]),c.value.forEach(function(b,d){d>0&&(n+=l.sep),"integer"==c.type||"double"==c.type||"boolean"==c.type?b=g(b,c.type,!0):a||(b=h(b)),l.fn&&(b=l.fn(b)),a?(n+="question_mark"==a?"?":"$"+e,i.push(b),e++):("string"==typeof b&&(b="'"+b+"'"),n+=b)})),j.push(c.field+" "+l.op.replace(/\?/,n))}}),j.join(" "+c.condition+b)}(c);return a?{sql:j,params:i}:{sql:j}},getSqlOperator:function(a){var b=this.settings.sqlOperators[a];return void 0===b?!1:("string"==typeof b&&(b={op:b}),b.list&&!b.sep&&(b.sep=", "),b)}}),k.define("unique-filter",function(){this.status.used_filters={},this.on("afterUpdateRuleFilter",this.updateDisabledFilters),this.on("afterDeleteRule",this.updateDisabledFilters),this.on("afterCreateRuleFilters",this.applyDisabledFilters)}),k.extend({updateDisabledFilters:function(){var a=this;this.status.used_filters={},this.model&&(!function b(c){c.each(function(b){b.filter&&b.filter.unique&&(a.status.used_filters[b.filter.id]||(a.status.used_filters[b.filter.id]=[]),"group"==b.filter.unique&&a.status.used_filters[b.filter.id].push(b.parent))},function(a){b(a)})}(this.model.root),this.applyDisabledFilters())},applyDisabledFilters:function(){var a=this;this.$el.find(".rule-filter-container option").prop("disabled",!1),$.each(this.status.used_filters,function(b,c){0===c.length?a.$el.find(".rule-filter-container option[value="+b+"]:not(:selected)").prop("disabled",!0):c.forEach(function(a){a.each(function(a){a.$el.find(".rule-filter-container option[value="+b+"]:not(:selected)").prop("disabled",!0)})})}),this.settings.plugins&&this.settings.plugins["bt-selectpicker"]&&this.$el.find(".rule-filter-container select").selectpicker("render")}})});